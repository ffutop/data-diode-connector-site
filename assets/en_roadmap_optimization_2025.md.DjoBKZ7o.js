import{_ as e,I as l,c as r,o as i,a6 as a,b as h,w as n,a as p,J as k,a8 as o}from"./chunks/framework.Cpr3xyXy.js";const f=JSON.parse('{"title":"DDC Roadmap 2025 - Observability & Kafka Modernization","description":"Strategic roadmap for Data Diode Connector (DDC) in 2025. Focuses on migrating observability to Vector for ARM64 compatibility and upgrading Kafka client to rdkafka for KRaft support.","frontmatter":{"title":"DDC Roadmap 2025 - Observability & Kafka Modernization","description":"Strategic roadmap for Data Diode Connector (DDC) in 2025. Focuses on migrating observability to Vector for ARM64 compatibility and upgrading Kafka client to rdkafka for KRaft support.","head":[["meta",{"name":"keywords","content":"DDC Roadmap, Vector Observability, rdkafka migration, ARM64 support, Kafka 4.0, Architectural Optimization"}]],"seo":{"proficiencyLevel":"Advanced","keywords":["Product Roadmap","Observability Stack","Kafka Modernization","Vector","rdkafka"]}},"headers":[],"relativePath":"en/roadmap_optimization_2025.md","filePath":"en/roadmap_optimization_2025.md","lastUpdated":1764595667000}'),d={name:"en/roadmap_optimization_2025.md"};function g(c,s,E,y,u,F){const t=l("Mermaid");return i(),r("div",null,[s[1]||(s[1]=a('<h1 id="architecture-optimization-roadmap-2025" tabindex="-1">Architecture Optimization Roadmap (2025) <a class="header-anchor" href="#architecture-optimization-roadmap-2025" aria-label="Permalink to “Architecture Optimization Roadmap (2025)”">​</a></h1><h2 id="_1-background-objectives" tabindex="-1">1. Background &amp; Objectives <a class="header-anchor" href="#_1-background-objectives" aria-label="Permalink to “1. Background &amp; Objectives”">​</a></h2><p>As the Data Diode Connector (DDC) deployment environments diversify (e.g., <strong>ARM64</strong> edge devices) and upstream middleware evolves (e.g., <strong>Kafka 4.x</strong>), the current version has exposed limitations in <strong>observability infrastructure</strong> and <strong>core protocol compatibility</strong>.</p><p>This document details the analysis of two core issues and proposes a concrete architectural adjustment and implementation roadmap.</p><hr><h2 id="_2-problem-analysis" tabindex="-1">2. Problem Analysis <a class="header-anchor" href="#_2-problem-analysis" aria-label="Permalink to “2. Problem Analysis”">​</a></h2><h3 id="_2-1-issue-1-observability-component-compatibility-on-arm" tabindex="-1">2.1. Issue 1: Observability Component Compatibility on ARM <a class="header-anchor" href="#_2-1-issue-1-observability-component-compatibility-on-arm" aria-label="Permalink to “2.1. Issue 1: Observability Component Compatibility on ARM”">​</a></h3><p><strong>Current Status:</strong></p><ul><li>Using <code>fluent-bit</code> as the log collector.</li><li><strong>Crash Issue</strong>: On <strong>ARM64 (aarch64)</strong> architecture, <code>fluent-bit</code>&#39;s default memory allocator <code>jemalloc</code> conflicts with Transparent Huge Pages (THP) or 64k page size configurations in some Linux kernels, causing Segmentation Faults on startup.</li><li><strong>Missing Metrics</strong>: The current <code>fluent-bit</code> configuration does not correctly handle StatsD metrics sent by DDC, leading to loss of monitoring data (e.g., <code>dropped_packets</code>, <code>bytes_sent</code>). Although <code>telegraf.conf</code> exists in the deploy directory, the architecture feels fragmented (Logs via Fluent, Metrics via Telegraf).</li></ul><p><strong>Impact:</strong></p><ul><li>Difficult deployment on edge devices (often ARM-based).</li><li>Operators are &quot;flying blind&quot; without key operational metrics like packet loss rate and throughput.</li></ul><h3 id="_2-2-issue-2-outdated-kafka-client-protocol" tabindex="-1">2.2. Issue 2: Outdated Kafka Client Protocol <a class="header-anchor" href="#_2-2-issue-2-outdated-kafka-client-protocol" aria-label="Permalink to “2.2. Issue 2: Outdated Kafka Client Protocol”">​</a></h3><p><strong>Current Status:</strong></p><ul><li>DDC&#39;s <code>ph_kafka</code> module depends on the <code>rust-kafka</code> crate.</li><li><code>rust-kafka</code> is a pure Rust implementation but has low maintenance activity and mainly supports older Kafka 0.8.x - 2.x protocol APIs.</li><li><strong>Future Incompatibility</strong>: Kafka 4.0+ (KRaft mode) is gradually deprecating and removing support for older protocols.</li></ul><p><strong>Impact:</strong></p><ul><li>Inability to connect to the latest Kafka clusters.</li><li>Limited or no support for modern authentication mechanisms like SASL/SCRAM.</li><li>Performance and stability lag behind industrial-grade client implementations.</li></ul><hr><h2 id="_3-solutions-technology-selection" tabindex="-1">3. Solutions &amp; Technology Selection <a class="header-anchor" href="#_3-solutions-technology-selection" aria-label="Permalink to “3. Solutions &amp; Technology Selection”">​</a></h2><h3 id="_3-1-observability-refactoring-migrate-to-vector" tabindex="-1">3.1. Observability Refactoring: Migrate to Vector <a class="header-anchor" href="#_3-1-observability-refactoring-migrate-to-vector" aria-label="Permalink to “3.1. Observability Refactoring: Migrate to Vector”">​</a></h3><p>To resolve ARM compatibility and unify log/metric collection, we propose deprecating <code>fluent-bit</code> in favor of <strong><a href="https://vector.dev/" target="_blank" rel="noreferrer">Vector</a></strong>.</p><p><strong>Why Vector?</strong></p><ol><li><strong>Unified Rust Ecosystem</strong>: Vector is also written in Rust, sharing the same technology stack as DDC, ensuring memory safety and high performance.</li><li><strong>Native ARM Support</strong>: Vector builds and runs stably on ARM64 without relying on specific <code>jemalloc</code> hacks.</li><li><strong>Unified Pipeline</strong>: Vector can act as both a Syslog Server (UDP/TCP) and a StatsD Server. It can cleanse logs before sending them to Elasticsearch/File, and aggregate StatsD metrics to expose them as Prometheus Metrics.</li><li><strong>Flexible Configuration</strong>: The Vector Remap Language (VRL) allows for extremely flexible processing of DDC&#39;s structured logs.</li></ol><p><strong>Architecture Change Preview:</strong></p>',23)),(i(),h(o,null,{default:n(()=>[k(t,{id:"mermaid-135",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20DDC%5BDDC%20Ingress%2FEgress%5D%20--%3E%7CSyslog%20UDP%3A514%7C%20Vector%0A%20%20%20%20DDC%20--%3E%7CStatsD%20UDP%3A8125%7C%20Vector%0A%20%20%20%20Vector%20--%3E%7CLog%20Stream%7C%20File%2FLoki%2FES%0A%20%20%20%20Vector%20--%3E%7CPrometheus%20Scrape%7C%20Prometheus%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[p(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h3 id="_3-2-kafka-client-upgrade-migrate-to-rdkafka" tabindex="-1">3.2. Kafka Client Upgrade: Migrate to rdkafka <a class="header-anchor" href="#_3-2-kafka-client-upgrade-migrate-to-rdkafka" aria-label="Permalink to “3.2. Kafka Client Upgrade: Migrate to rdkafka”">​</a></h3><p>To support Kafka 4.x and higher performance, we suggest migrating the underlying dependency from <code>rust-kafka</code> to <strong><code>rdkafka</code></strong>.</p><p><strong>Why rdkafka?</strong></p><ol><li><strong>Industry Standard</strong>: <code>rdkafka</code> is the Rust binding for <code>librdkafka</code> (C library). <code>librdkafka</code> is the most authoritative, feature-rich, and performant Kafka client implementation outside of the official Java client.</li><li><strong>Protocol Support</strong>: Day-one support for new Kafka features (e.g., Transaction, Idempotency, Zstd compression, Modern SASL).</li><li><strong>Stability</strong>: Proven in large-scale production environments.</li></ol><p><strong>Challenges &amp; Mitigation:</strong></p><ul><li><strong>Build Complexity</strong>: <code>rdkafka</code> depends on C libraries (<code>openssl</code>, <code>sasl</code>, <code>zstd</code>).</li><li><strong>Mitigation</strong>: Enable the <code>cmake-build</code> feature in <code>Cargo.toml</code> and install necessary C compilation toolchains during the Dockerfile build stage (Multi-stage build). While this increases compile time, the runtime performance and compatibility gains are immense.</li></ul><hr><h2 id="_4-implementation-details" tabindex="-1">4. Implementation Details <a class="header-anchor" href="#_4-implementation-details" aria-label="Permalink to “4. Implementation Details”">​</a></h2><h3 id="_4-1-vector-configuration-example-replacing-fluent-bit" tabindex="-1">4.1. Vector Configuration Example (Replacing Fluent-bit) <a class="header-anchor" href="#_4-1-vector-configuration-example-replacing-fluent-bit" aria-label="Permalink to “4.1. Vector Configuration Example (Replacing Fluent-bit)”">​</a></h3><p>Create a new configuration file <code>deploy/vector/vector.toml</code>:</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:8686&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. Receive DDC Syslog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ddc_logs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;syslog&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:514&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mode = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;udp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. Receive DDC StatsD Metrics</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ddc_metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;statsd&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:8125&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mode = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;udp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. Process Logs (e.g., Parse JSON)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transforms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse_logs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;remap&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc_logs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">. = parse_json(.message) ?? .</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. Output Logs to Console (or File/Loki)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">console_out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;console&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parse_logs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">encoding.codec = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. Expose Metrics to Prometheus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prometheus_exporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prometheus_exporter&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc_metrics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:9090&quot;</span></span></code></pre></div><h3 id="_4-2-kafka-code-refactoring-rust" tabindex="-1">4.2. Kafka Code Refactoring (Rust) <a class="header-anchor" href="#_4-2-kafka-code-refactoring-rust" aria-label="Permalink to “4.2. Kafka Code Refactoring (Rust)”">​</a></h3><p><strong>Modify <code>protocol_handlers/ph_kafka/Cargo.toml</code>:</strong></p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Remove rust-kafka</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kafka = &quot;0.8&quot; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add rdkafka</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rdkafka = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.34&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ssl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sasl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gssapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tokio = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;full&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rdkafka is often used with async</span></span></code></pre></div><p><strong>Modify <code>consumer.rs</code> (Pseudo-code Idea):</strong></p><p>Original <code>rust-kafka</code> is a synchronous blocking model. <code>rdkafka</code> recommends using the <code>Stream</code> async model, but to maintain DDC&#39;s existing threading model, we can use <code>BaseConsumer</code> (Synchronous) or run a <code>Runtime</code> within the existing DDC thread.</p><p>Recommendation: Since DDC core is based on <code>std::thread</code>, using <code>rdkafka::consumer::BaseConsumer</code> is the smoothest migration path.</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rdkafka</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClientConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rdkafka</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KafkaConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BipBufferWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseConsumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ClientConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bootstrap.servers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;group.id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Consumer creation failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Can&#39;t subscribe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Poll for messages</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">poll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_millis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // Write to RingBuffer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Kafka error: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            None</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Idle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_5-iteration-plan" tabindex="-1">5. Iteration Plan <a class="header-anchor" href="#_5-iteration-plan" aria-label="Permalink to “5. Iteration Plan”">​</a></h2><h3 id="phase-1-infrastructure-upgrade-v1-1-0" tabindex="-1">Phase 1: Infrastructure Upgrade (v1.1.0) <a class="header-anchor" href="#phase-1-infrastructure-upgrade-v1-1-0" aria-label="Permalink to “Phase 1: Infrastructure Upgrade (v1.1.0)”">​</a></h3><ul><li>[ ] <strong>Task</strong>: Create <code>deploy/vector</code> directory and configuration.</li><li>[ ] <strong>Task</strong>: Update <code>Dockerfile</code> and Kubernetes Helm Charts, replacing the Fluent-bit sidecar with Vector.</li><li>[ ] <strong>Verify</strong>: Deploy on ARM64 (e.g., Raspberry Pi or AWS Graviton) and verify no crashes.</li><li>[ ] <strong>Verify</strong>: Access Vector&#39;s Prometheus endpoint and confirm metrics like <code>ddc_ingress_packets_sent</code> are visible.</li></ul><h3 id="phase-2-kafka-core-upgrade-v1-2-0" tabindex="-1">Phase 2: Kafka Core Upgrade (v1.2.0) <a class="header-anchor" href="#phase-2-kafka-core-upgrade-v1-2-0" aria-label="Permalink to “Phase 2: Kafka Core Upgrade (v1.2.0)”">​</a></h3><ul><li>[ ] <strong>Task</strong>: Refactor <code>ph_kafka</code> crate, replacing dependency with <code>rdkafka</code>.</li><li>[ ] <strong>Task</strong>: Update Docker build environment, installing <code>libssl-dev</code>, <code>libsasl2-dev</code>, <code>cmake</code>.</li><li>[ ] <strong>Task</strong>: Update <code>Config.toml</code> structure (if new config items are needed, e.g., <code>sasl_mechanism</code>).</li><li>[ ] <strong>Test</strong>: Connectivity testing with Kafka 3.x and 4.x (Preview).</li></ul>`,24))])}const C=e(d,[["render",g]]);export{f as __pageData,C as default};
