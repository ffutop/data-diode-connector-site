<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DDC 架构迭代与优化路线图 (2025) | Data Diode Connector</title>
    <meta name="description" content="Secure, high-performance, unidirectional data transfer suite powered by Rust.">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style._8r3gAuK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CxEXplqz.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Cpr3xyXy.js">
    <link rel="modulepreload" href="/assets/chunks/theme.CWsvf1-G.js">
    <link rel="modulepreload" href="/assets/en_roadmap_optimization_2025.md.C9TtFeeN.lean.js">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Risque&amp;display=swap">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-604a0865><div class="VPNavBar" data-v-604a0865 data-v-18128346><div class="wrapper" data-v-18128346><div class="container" data-v-18128346><div class="title" data-v-18128346><div class="VPNavBarTitle has-sidebar" data-v-18128346 data-v-d4488dd0><a class="title" href="/en/" data-v-d4488dd0><!--[--><!--]--><!----><span data-v-d4488dd0>Data Diode Connector</span><!--[--><!--]--></a></div></div><div class="content" data-v-18128346><div class="content-body" data-v-18128346><!--[--><!--]--><div class="VPNavBarSearch search" data-v-18128346><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-18128346 data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/en/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/en/software_architecture" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/en/configuration_reference" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Config</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/en/download" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Download</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/en/commercial" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Commercial</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-18128346 data-v-e9d6c6e1 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><span class="vpi-languages option-icon" data-v-d8fae6e2></span><!----><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><div class="items" data-v-e9d6c6e1><p class="title" data-v-e9d6c6e1>English</p><!--[--><div class="VPMenuLink" data-v-e9d6c6e1 data-v-acfa8338><a class="VPLink link" href="/zh-CN/roadmap_optimization_2025" lang="zh-CN" data-v-acfa8338><!--[--><span data-v-acfa8338>简体中文</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-18128346 data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-18128346 data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ffutop/DataDiodeConnector" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-18128346 data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><div class="group translations" data-v-600b50c9><p class="trans-title" data-v-600b50c9>English</p><!--[--><div class="VPMenuLink" data-v-600b50c9 data-v-acfa8338><a class="VPLink link" href="/zh-CN/roadmap_optimization_2025" lang="zh-CN" data-v-acfa8338><!--[--><span data-v-acfa8338>简体中文</span><!--]--></a></div><!--]--></div><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ffutop/DataDiodeConnector" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-18128346 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-18128346><div class="divider-line" data-v-18128346></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Architecture</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/software_architecture" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Software Architecture</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/deployment_topologies" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Deployment Topologies</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/security_model" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Security Model</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/protocol" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Protocol Specification</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Operations & Tuning</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/configuration_reference" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Configuration Reference</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/operations_guide" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Operations Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/flow_control" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Flow Control</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/en/kernel_tuning" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Kernel Tuning</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _en_roadmap_optimization_2025" data-v-d668f7cc><div><h1 id="ddc-架构迭代与优化路线图-2025" tabindex="-1">DDC 架构迭代与优化路线图 (2025) <a class="header-anchor" href="#ddc-架构迭代与优化路线图-2025" aria-label="Permalink to “DDC 架构迭代与优化路线图 (2025)”">​</a></h1><h2 id="_1-背景与目标" tabindex="-1">1. 背景与目标 <a class="header-anchor" href="#_1-背景与目标" aria-label="Permalink to “1. 背景与目标”">​</a></h2><p>随着 Data Diode Connector (DDC) 部署环境的多样化（如 ARM64 边缘设备）以及上游中间件（Kafka 4.x）的演进，当前版本在<strong>可观测性基础设施</strong>和<strong>核心协议兼容性</strong>方面暴露出了局限性。</p><p>本文档旨在详细分析当前面临的两个核心问题，并提出具体的架构调整方案与实施路线图。</p><hr><h2 id="_2-问题分析" tabindex="-1">2. 问题分析 <a class="header-anchor" href="#_2-问题分析" aria-label="Permalink to “2. 问题分析”">​</a></h2><h3 id="_2-1-问题一-可观测性组件在-arm-架构下的兼容性与功能缺失" tabindex="-1">2.1. 问题一：可观测性组件在 ARM 架构下的兼容性与功能缺失 <a class="header-anchor" href="#_2-1-问题一-可观测性组件在-arm-架构下的兼容性与功能缺失" aria-label="Permalink to “2.1. 问题一：可观测性组件在 ARM 架构下的兼容性与功能缺失”">​</a></h3><p><strong>现状：</strong></p><ul><li>当前使用 <code>fluent-bit</code> 作为日志收集器。</li><li><strong>Crash 问题</strong>：在 ARM64 (aarch64) 架构下，<code>fluent-bit</code> 默认集成的内存分配器 <code>jemalloc</code> 与部分 Linux 内核的透明大页 (THP) 或 64k 页大小配置存在冲突，导致 Segmentation Fault 无法启动。</li><li><strong>指标缺失</strong>：当前的 <code>fluent-bit</code> 配置未正确处理 DDC 发送的 StatsD 指标，导致监控数据（如 <code>dropped_packets</code>, <code>bytes_sent</code>）丢失。虽然部署目录中有 <code>telegraf.conf</code>，但架构上显得割裂（日志走 Fluent，指标走 Telegraf）。</li></ul><p><strong>影响：</strong></p><ul><li>边缘设备（常为 ARM 架构）部署困难。</li><li>运维人员无法获得丢包率、吞吐量等关键运行指标，变成了“盲飞”。</li></ul><h3 id="_2-2-问题二-kafka-客户端协议过时" tabindex="-1">2.2. 问题二：Kafka 客户端协议过时 <a class="header-anchor" href="#_2-2-问题二-kafka-客户端协议过时" aria-label="Permalink to “2.2. 问题二：Kafka 客户端协议过时”">​</a></h3><p><strong>现状：</strong></p><ul><li>DDC 的 <code>ph_kafka</code> 模块依赖于 <code>rust-kafka</code> crate。</li><li><code>rust-kafka</code> 是一个纯 Rust 实现，但维护活跃度较低，且主要支持 Kafka 0.8.x - 2.x 的旧版协议 API。</li><li><strong>不兼容未来</strong>：Kafka 4.0+ (KRaft mode) 正在逐步弃用和移除旧版协议支持。</li></ul><p><strong>影响：</strong></p><ul><li>无法连接最新的 Kafka 集群。</li><li>不支持 SASL/SCRAM 等现代认证机制（或支持有限）。</li><li>性能与稳定性不如经过工业级验证的客户端。</li></ul><hr><h2 id="_3-解决方案与技术选型" tabindex="-1">3. 解决方案与技术选型 <a class="header-anchor" href="#_3-解决方案与技术选型" aria-label="Permalink to “3. 解决方案与技术选型”">​</a></h2><h3 id="_3-1-可观测性重构-迁移至-vector" tabindex="-1">3.1. 可观测性重构：迁移至 Vector <a class="header-anchor" href="#_3-1-可观测性重构-迁移至-vector" aria-label="Permalink to “3.1. 可观测性重构：迁移至 Vector”">​</a></h3><p>为了解决 ARM 兼容性并统一日志与指标收集，建议弃用 <code>fluent-bit</code>，迁移至 <strong>Vector</strong>。</p><p><strong>选型理由：</strong></p><ol><li><strong>Rust 生态统一</strong>：Vector 也是用 Rust 编写的，与 DDC 的技术栈同源，内存安全且高性能。</li><li><strong>原生 ARM 支持</strong>：Vector 在 ARM64 上的构建和运行非常稳定，且不依赖 <code>jemalloc</code> 的特定 hack。</li><li><strong>统一管道</strong>：Vector 可以同时作为 Syslog Server (UDP/TCP) 和 StatsD Server。它可以将日志清洗后发往 Elasticsearch/File，同时将 StatsD 指标聚合后暴露为 Prometheus Metrics。</li><li><strong>配置灵活</strong>：使用 VRL (Vector Remap Language) 可以极其灵活地处理 DDC 的结构化日志。</li></ol><p><strong>架构变更预览：</strong></p><div class="mermaid"></div><h3 id="_3-2-kafka-客户端升级-迁移至-rdkafka" tabindex="-1">3.2. Kafka 客户端升级：迁移至 rdkafka <a class="header-anchor" href="#_3-2-kafka-客户端升级-迁移至-rdkafka" aria-label="Permalink to “3.2. Kafka 客户端升级：迁移至 rdkafka”">​</a></h3><p>为了支持 Kafka 4.x 及更高性能，建议将底层依赖从 <code>rust-kafka</code> 迁移至 <strong><code>rdkafka</code></strong>。</p><p><strong>选型理由：</strong></p><ol><li><strong>行业标准</strong>：<code>rdkafka</code> 是 <code>librdkafka</code> (C库) 的 Rust 绑定。<code>librdkafka</code> 是除 Java 官方客户端外最权威、功能最全、性能最高的 Kafka 客户端实现。</li><li><strong>协议支持</strong>：第一时间支持 Kafka 新特性（如 Transaction, Idempotency, Zstd compression, Modern SASL）。</li><li><strong>稳定性</strong>：经过了大规模生产环境验证。</li></ol><p><strong>挑战与对策：</strong></p><ul><li><strong>构建复杂性</strong>：<code>rdkafka</code> 依赖 C 库 (<code>openssl</code>, <code>sasl</code>, <code>zstd</code>)。</li><li><strong>对策</strong>：在 <code>Cargo.toml</code> 中启用 <code>cmake-build</code> 特性，并在 Dockerfile 构建阶段（Multi-stage build）安装必要的 C 编译工具链。虽然这会增加编译时间，但运行时性能和兼容性收益巨大。</li></ul><hr><h2 id="_4-实施细节与代码改造" tabindex="-1">4. 实施细节与代码改造 <a class="header-anchor" href="#_4-实施细节与代码改造" aria-label="Permalink to “4. 实施细节与代码改造”">​</a></h2><h3 id="_4-1-vector-配置示例-替代-fluent-bit" tabindex="-1">4.1. Vector 配置示例 (替代 Fluent-bit) <a class="header-anchor" href="#_4-1-vector-配置示例-替代-fluent-bit" aria-label="Permalink to “4.1. Vector 配置示例 (替代 Fluent-bit)”">​</a></h3><p>创建新的配置文件 <code>deploy/vector/vector.toml</code>：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:8686&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 接收 DDC 的 Syslog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ddc_logs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;syslog&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:514&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mode = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;udp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 接收 DDC 的 StatsD 指标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ddc_metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;statsd&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:8125&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mode = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;udp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 处理日志 (例如解析 JSON)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transforms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse_logs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;remap&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc_logs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">. = parse_json(.message) ?? .</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 输出日志到控制台 (或文件/Loki)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">console_out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;console&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parse_logs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">encoding.codec = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 将指标暴露给 Prometheus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prometheus_exporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prometheus_exporter&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc_metrics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:9090&quot;</span></span></code></pre></div><h3 id="_4-2-kafka-代码重构-rust" tabindex="-1">4.2. Kafka 代码重构 (Rust) <a class="header-anchor" href="#_4-2-kafka-代码重构-rust" aria-label="Permalink to “4.2. Kafka 代码重构 (Rust)”">​</a></h3><p><strong>修改 <code>protocol_handlers/ph_kafka/Cargo.toml</code>:</strong></p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 移除 rust-kafka</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kafka = &quot;0.8&quot; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加 rdkafka</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rdkafka = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.34&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ssl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sasl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gssapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tokio = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;full&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rdkafka 通常配合 async 使用</span></span></code></pre></div><p><strong>修改 <code>consumer.rs</code> (伪代码思路):</strong></p><p>原 <code>rust-kafka</code> 是同步阻塞模型，<code>rdkafka</code> 推荐使用 <code>Stream</code> 异步模型，但为了保持 DDC 现有的线程模型，可以使用 <code>BaseConsumer</code> (同步) 或在 DDC 现有线程中运行 <code>Runtime</code>。</p><p>建议：由于 DDC 核心是基于 <code>std::thread</code> 的，使用 <code>rdkafka::consumer::BaseConsumer</code> 是最平滑的迁移路径。</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rdkafka</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClientConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rdkafka</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KafkaConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BipBufferWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseConsumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ClientConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bootstrap.servers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;group.id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ddc-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;enable.auto.commit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Consumer creation failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Can&#39;t subscribe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Poll for messages</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">poll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_millis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // 写入 RingBuffer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Kafka error: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            None</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Idle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_5-迭代计划" tabindex="-1">5. 迭代计划 <a class="header-anchor" href="#_5-迭代计划" aria-label="Permalink to “5. 迭代计划”">​</a></h2><h3 id="阶段一-基础设施升级-v1-1-0" tabindex="-1">阶段一：基础设施升级 (v1.1.0) <a class="header-anchor" href="#阶段一-基础设施升级-v1-1-0" aria-label="Permalink to “阶段一：基础设施升级 (v1.1.0)”">​</a></h3><ul><li>[ ] <strong>任务</strong>: 创建 <code>deploy/vector</code> 目录及配置。</li><li>[ ] <strong>任务</strong>: 更新 <code>Dockerfile</code> 和 Kubernetes Helm Charts，将 Sidecar 从 Fluent-bit 替换为 Vector。</li><li>[ ] <strong>验证</strong>: 在 ARM64 (如 Raspberry Pi 或 AWS Graviton) 上部署，验证无 Crash。</li><li>[ ] <strong>验证</strong>: 访问 Vector 的 Prometheus 端点，确认能看到 <code>ddc_ingress_packets_sent</code> 等指标。</li></ul><h3 id="阶段二-kafka-核心升级-v1-2-0" tabindex="-1">阶段二：Kafka 核心升级 (v1.2.0) <a class="header-anchor" href="#阶段二-kafka-核心升级-v1-2-0" aria-label="Permalink to “阶段二：Kafka 核心升级 (v1.2.0)”">​</a></h3><ul><li>[ ] <strong>任务</strong>: 重构 <code>ph_kafka</code> crate，替换依赖为 <code>rdkafka</code>。</li><li>[ ] <strong>任务</strong>: 更新 Docker 构建环境，安装 <code>libssl-dev</code>, <code>libsasl2-dev</code>, <code>cmake</code>。</li><li>[ ] <strong>任务</strong>: 更新 <code>Config.toml</code> 结构（如果需要新的配置项，如 <code>sasl_mechanism</code>）。</li><li>[ ] <strong>测试</strong>: 使用 Kafka 3.x 和 4.x (Preview) 进行连通性测试。</li></ul></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/ffutop/DataDiodeConnector/edit/master/docs/en/roadmap_optimization_2025.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page on GitHub<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><!----></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/en/software_architecture" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Software Architecture</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><!----><p class="copyright" data-v-5b9946f5>Copyright © 2025 ffutop</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"en_commercial.md\":\"DwHvMeMF\",\"en_configuration_reference.md\":\"DCgcEUMG\",\"en_deployment_topologies.md\":\"Dn1tRwGi\",\"en_developer_guide.md\":\"CuNhVZD9\",\"en_download.md\":\"IOGx-Xmg\",\"en_flow_control.md\":\"CUjN5fvn\",\"en_index.md\":\"Cey1KPaz\",\"en_kernel_tuning.md\":\"BBGKcKcR\",\"en_operations_guide.md\":\"CkrHA6gr\",\"en_protocol.md\":\"BK_5NiM7\",\"en_roadmap_optimization_2025.md\":\"C9TtFeeN\",\"en_security_model.md\":\"C_M7aJiA\",\"en_software_architecture.md\":\"CLpf2Km5\",\"index.md\":\"CeDYDUec\",\"zh-cn_commercial.md\":\"CPjIKUVv\",\"zh-cn_configuration_reference.md\":\"D2KBZKAD\",\"zh-cn_deployment_topologies.md\":\"NiJmh3GL\",\"zh-cn_developer_guide.md\":\"eiPZkvFT\",\"zh-cn_download.md\":\"BqBfaLyA\",\"zh-cn_flow_control.md\":\"YnEnP7_y\",\"zh-cn_index.md\":\"DkQcL7Wk\",\"zh-cn_kernel_tuning.md\":\"CA4NIKu0\",\"zh-cn_operations_guide.md\":\"BG3cRBEa\",\"zh-cn_protocol.md\":\"CU3nUKFb\",\"zh-cn_security_model.md\":\"CPa0fkWF\",\"zh-cn_software_architecture.md\":\"DWVwD773\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Data Diode Connector\",\"description\":\"Secure, high-performance, unidirectional data transfer suite powered by Rust.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ffutop/DataDiodeConnector\"}],\"search\":{\"provider\":\"local\"}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"/en/\",\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/en/\"},{\"text\":\"Guide\",\"link\":\"/en/software_architecture\"},{\"text\":\"Config\",\"link\":\"/en/configuration_reference\"},{\"text\":\"Download\",\"link\":\"/en/download\"},{\"text\":\"Commercial\",\"link\":\"/en/commercial\"}],\"sidebar\":[{\"text\":\"Architecture\",\"collapsed\":false,\"items\":[{\"text\":\"Software Architecture\",\"link\":\"/en/software_architecture\"},{\"text\":\"Deployment Topologies\",\"link\":\"/en/deployment_topologies\"},{\"text\":\"Security Model\",\"link\":\"/en/security_model\"},{\"text\":\"Protocol Specification\",\"link\":\"/en/protocol\"}]},{\"text\":\"Operations & Tuning\",\"collapsed\":false,\"items\":[{\"text\":\"Configuration Reference\",\"link\":\"/en/configuration_reference\"},{\"text\":\"Operations Guide\",\"link\":\"/en/operations_guide\"},{\"text\":\"Flow Control\",\"link\":\"/en/flow_control\"},{\"text\":\"Kernel Tuning\",\"link\":\"/en/kernel_tuning\"}]}],\"footer\":{\"copyright\":\"Copyright © 2025 ffutop\"},\"editLink\":{\"pattern\":\"https://github.com/ffutop/DataDiodeConnector/edit/master/docs/:path\",\"text\":\"Edit this page on GitHub\"}}},\"zh-CN\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"link\":\"/zh-CN/\",\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/zh-CN/\"},{\"text\":\"指南\",\"link\":\"/zh-CN/software_architecture\"},{\"text\":\"配置\",\"link\":\"/zh-CN/configuration_reference\"},{\"text\":\"下载\",\"link\":\"/zh-CN/download\"},{\"text\":\"商业版\",\"link\":\"/zh-CN/commercial\"}],\"sidebar\":[{\"text\":\"架构设计\",\"collapsed\":false,\"items\":[{\"text\":\"软件架构\",\"link\":\"/zh-CN/software_architecture\"},{\"text\":\"部署拓扑与高可用\",\"link\":\"/zh-CN/deployment_topologies\"},{\"text\":\"安全模型\",\"link\":\"/zh-CN/security_model\"},{\"text\":\"协议规范\",\"link\":\"/zh-CN/protocol\"}]},{\"text\":\"运维与调优\",\"collapsed\":false,\"items\":[{\"text\":\"配置参考手册\",\"link\":\"/zh-CN/configuration_reference\"},{\"text\":\"运维指南\",\"link\":\"/zh-CN/operations_guide\"},{\"text\":\"流量控制\",\"link\":\"/zh-CN/flow_control\"},{\"text\":\"内核调优\",\"link\":\"/zh-CN/kernel_tuning\"}]}],\"footer\":{\"message\":\"基于 Apache-2.0 许可发布\",\"copyright\":\"版权所有 © 2020-2025 Ministerie van Defensie & 贡献者\"},\"editLink\":{\"pattern\":\"https://github.com/ffutop/DataDiodeConnector/edit/master/docs/:path\",\"text\":\"在 GitHub 上编辑此页\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"outline\":{\"label\":\"页面导航\"},\"lastUpdated\":{\"text\":\"最后更新于\"},\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"主题\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\"}}},\"scrollOffset\":134,\"cleanUrls\":true,\"additionalConfig\":{}}");</script>
    
  </body>
</html>