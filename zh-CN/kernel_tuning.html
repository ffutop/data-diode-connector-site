<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内核级性能调优 | Data Diode Connector</title>
    <meta name="description" content="Secure, high-performance, unidirectional data transfer suite powered by Rust.">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style._8r3gAuK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DNzYGW1P.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Cpr3xyXy.js">
    <link rel="modulepreload" href="/assets/chunks/theme.BwH7Z01c.js">
    <link rel="modulepreload" href="/assets/zh-CN_kernel_tuning.md.CA4NIKu0.lean.js">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Risque&amp;display=swap">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-604a0865><div class="VPNavBar" data-v-604a0865 data-v-18128346><div class="wrapper" data-v-18128346><div class="container" data-v-18128346><div class="title" data-v-18128346><div class="VPNavBarTitle has-sidebar" data-v-18128346 data-v-d4488dd0><a class="title" href="/zh-CN/" data-v-d4488dd0><!--[--><!--]--><!----><span data-v-d4488dd0>Data Diode Connector</span><!--[--><!--]--></a></div></div><div class="content" data-v-18128346><div class="content-body" data-v-18128346><!--[--><!--]--><div class="VPNavBarSearch search" data-v-18128346><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-18128346 data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-CN/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-CN/software_architecture" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>指南</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-CN/configuration_reference" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>配置</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-CN/download" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>下载</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-CN/commercial" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>商业版</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-18128346 data-v-e9d6c6e1 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><span class="vpi-languages option-icon" data-v-d8fae6e2></span><!----><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><div class="items" data-v-e9d6c6e1><p class="title" data-v-e9d6c6e1>简体中文</p><!--[--><div class="VPMenuLink" data-v-e9d6c6e1 data-v-acfa8338><a class="VPLink link" href="/en/kernel_tuning" lang="en" data-v-acfa8338><!--[--><span data-v-acfa8338>English</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-18128346 data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-18128346 data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ffutop/DataDiodeConnector" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-18128346 data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><div class="group translations" data-v-600b50c9><p class="trans-title" data-v-600b50c9>简体中文</p><!--[--><div class="VPMenuLink" data-v-600b50c9 data-v-acfa8338><a class="VPLink link" href="/en/kernel_tuning" lang="en" data-v-acfa8338><!--[--><span data-v-acfa8338>English</span><!--]--></a></div><!--]--></div><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>主题</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ffutop/DataDiodeConnector" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-18128346 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-18128346><div class="divider-line" data-v-18128346></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>回到顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>架构设计</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/software_architecture" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>软件架构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/deployment_topologies" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>部署拓扑与高可用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/security_model" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>安全模型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/protocol" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>协议规范</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>运维与调优</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/configuration_reference" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>配置参考手册</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/operations_guide" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>运维指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/flow_control" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>流量控制</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/zh-CN/kernel_tuning" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>内核调优</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>页面导航</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _zh-CN_kernel_tuning" data-v-d668f7cc><div><h1 id="内核级性能调优" tabindex="-1">内核级性能调优 <a class="header-anchor" href="#内核级性能调优" aria-label="Permalink to “内核级性能调优”">​</a></h1><p>尽管网闸连接器通过 Rust 实现、无锁缓冲区和高效数据处理被设计为高性能应用，但要达到最大的吞吐量，尤其是在 1Gbps 或 10Gbps 的线速（Line Rate）下，通常需要对底层操作系统内核进行调优。网闸连接器在用户空间应用层运行，但其性能从根本上受限于 Linux 内核处理网络数据包和 CPU 资源的效率。</p><p>本指南重点介绍可能显著影响网闸连接器基于 UDP 传输性能的 Linux 内核参数和系统配置。</p><h2 id="udp-socket-缓冲区大小" tabindex="-1">UDP Socket 缓冲区大小 <a class="header-anchor" href="#udp-socket-缓冲区大小" aria-label="Permalink to “UDP Socket 缓冲区大小”">​</a></h2><p>高速 UDP 应用最常见的瓶颈是内核为 UDP Socket 分配的默认缓冲区大小。如果内核的接收缓冲区在网闸连接器（或任何用户空间应用）读取数据包之前就已填满，内核将静默丢弃传入的数据包。同样，一个小的发送缓冲区会限制网闸连接器可以排队传输的数据量。</p><h3 id="关键-sysctl-参数" tabindex="-1">关键 <code>sysctl</code> 参数： <a class="header-anchor" href="#关键-sysctl-参数" aria-label="Permalink to “关键 sysctl 参数：”">​</a></h3><ul><li><strong><code>net.core.rmem_max</code></strong>：所有类型 Socket 的最大接收缓冲区大小（字节）。</li><li><strong><code>net.core.wmem_max</code></strong>：所有类型 Socket 的最大发送缓冲区大小（字节）。</li><li><strong><code>net.core.rmem_default</code></strong>：所有类型 Socket 的默认接收缓冲区大小。</li><li><strong><code>net.core.wmem_default</code></strong>：所有类型 Socket 的默认发送缓冲区大小。</li></ul><p><em>推荐示例（适用于 10Gbps+ 环境）：</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 临时设置（重启后失效）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.core.rmem_max=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67108864</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 64 MB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.core.wmem_max=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67108864</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 64 MB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.core.rmem_default=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67108864</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.core.wmem_default=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67108864</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如需永久生效，请添加到 /etc/sysctl.conf 文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># net.core.rmem_max = 67108864</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># net.core.wmem_max = 67108864</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># net.core.rmem_default = 67108864</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># net.core.wmem_default = 67108864</span></span></code></pre></div><h3 id="监控-udp-缓冲区溢出" tabindex="-1">监控 UDP 缓冲区溢出： <a class="header-anchor" href="#监控-udp-缓冲区溢出" aria-label="Permalink to “监控 UDP 缓冲区溢出：”">​</a></h3><p>使用 <code>netstat -su</code> 或 <code>ss -su</code> 监控接收和发送缓冲区错误。查找“receive buffer errors”或“packets dropped”计数。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -su</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Udp:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     65535 packets dropped</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     ...</span></span></code></pre></div><h2 id="cpu-亲和性与中断" tabindex="-1">CPU 亲和性与中断 <a class="header-anchor" href="#cpu-亲和性与中断" aria-label="Permalink to “CPU 亲和性与中断”">​</a></h2><p>网络数据包处理，特别是在多核系统上，可以通过 CPU 绑定（CPU pinning）和中断平衡得到显著改善。</p><h3 id="网闸连接器进程的-cpu-亲和性" tabindex="-1">网闸连接器进程的 CPU 亲和性： <a class="header-anchor" href="#网闸连接器进程的-cpu-亲和性" aria-label="Permalink to “网闸连接器进程的 CPU 亲和性：”">​</a></h3><p>为网闸连接器入口代理/出口代理进程分配专用的 CPU 核心。这减少了上下文切换，并确保网闸连接器独占 CPU 资源。</p><p><em>示例（将进程绑定到 CPU 1 和 2）：</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taskset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1,2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ddc_进程I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="中断请求-irq-亲和性" tabindex="-1">中断请求 (IRQ) 亲和性： <a class="header-anchor" href="#中断请求-irq-亲和性" aria-label="Permalink to “中断请求 (IRQ) 亲和性：”">​</a></h3><p>确保网卡中断由专用的 CPU 核心处理，最好与运行 DDC 进程的 CPU 核心不同。这可以防止 DDC 应用程序与网卡中断争夺 CPU 时间。<code>irqbalance</code> 等工具可以自动化此过程，但对于关键的高性能设置，可能需要通过 <code>/proc/irq/&lt;IRQ_NUMBER&gt;/smp_affinity</code> 进行手动绑定。</p><h2 id="网卡-nic-卸载" tabindex="-1">网卡 (NIC) 卸载 <a class="header-anchor" href="#网卡-nic-卸载" aria-label="Permalink to “网卡 (NIC) 卸载”">​</a></h2><p>现代网卡可以从 CPU 卸载各种任务，显著提高网络性能。然而，如果网闸连接器在原始数据包级别进行深度包检测 (DPI)，某些卸载功能可能会产生干扰。对于网闸连接器当前的模型（协议处理器处理已接收到的应用层数据），卸载通常是有益的。</p><h3 id="关键-ethtool-参数" tabindex="-1">关键 <code>ethtool</code> 参数： <a class="header-anchor" href="#关键-ethtool-参数" aria-label="Permalink to “关键 ethtool 参数：”">​</a></h3><ul><li><strong>通用接收卸载 (Generic Receive Offload, GRO)</strong>：在将多个传入数据包传递给内核之前，将其整合为更大的“超级数据包”。这减少了内核需要处理的数据包数量。</li><li><strong>通用分段卸载 (Generic Segmentation Offload, GSO)</strong>：对传出数据包执行相反操作，允许网闸连接器发送大的数据块，然后网卡将其分段为多个较小的数据包。</li><li><strong>校验和卸载 (Checksum Offload, Tx/Rx)</strong>：网卡而不是 CPU 来计算/验证校验和。</li></ul><p><em>示例（检查状态并启用）：</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查接口（例如 eth0）的当前状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用 GRO/GSO/校验和（通常默认启用）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gro</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gso</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tx-checksum-ip-generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rx-checksum-ip-generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span></span></code></pre></div><h2 id="中断合并-interrupt-coalescing" tabindex="-1">中断合并 (Interrupt Coalescing) <a class="header-anchor" href="#中断合并-interrupt-coalescing" aria-label="Permalink to “中断合并 (Interrupt Coalescing)”">​</a></h2><p>中断合并将网卡产生的多个硬件中断合并为一个 CPU 中断。这减少了 CPU 开销，但可能会略微增加延迟。</p><h3 id="关键-ethtool-参数-1" tabindex="-1">关键 <code>ethtool</code> 参数： <a class="header-anchor" href="#关键-ethtool-参数-1" aria-label="Permalink to “关键 ethtool 参数：”">​</a></h3><ul><li><strong><code>rx-frames</code></strong>：在生成中断之前接收到的帧数。</li><li><strong><code>rx-usecs</code></strong>：在生成中断之前等待的微秒数。</li></ul><p>调整这些参数是一个权衡过程：较高的值（更积极的合并）导致较低的 CPU 利用率但较高的延迟；较低的值（较少的合并）导致较高的 CPU 利用率但较低的延迟。对于网闸连接器，特别是在 <code>send_delay_ms=0</code> 时，平衡至关重要。</p><p><em>示例（调整合并）：</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查当前设置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置自定义值（例如，更积极的合并）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rx-frames</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 256</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rx-usecs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span></span></code></pre></div><h2 id="巨型帧-jumbo-frames" tabindex="-1">巨型帧 (Jumbo Frames) <a class="header-anchor" href="#巨型帧-jumbo-frames" aria-label="Permalink to “巨型帧 (Jumbo Frames)”">​</a></h2><p>如果您的整个网络路径（网卡、交换机、路由器）都支持巨型帧（更大的 MTU，例如 9000 字节而非 1500），则可以减少数据包开销和 CPU 周期，因为每个数据包可以承载更多数据。</p><p><em>示例（将 MTU 设置为 9000）：</em></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9000</span></span></code></pre></div><blockquote><p><strong>警告</strong>：确保路径中的所有设备都支持更大的 MTU，否则数据包将被分段或丢弃，导致性能下降。</p></blockquote><h2 id="监控工具" tabindex="-1">监控工具 <a class="header-anchor" href="#监控工具" aria-label="Permalink to “监控工具”">​</a></h2><p>为了有效调优，持续监控至关重要：</p><ul><li><strong><code>netstat -su</code> / <code>ss -su</code></strong>：UDP 数据包统计信息，包括丢弃的数据包。</li><li><strong><code>sar -n UDP 1</code></strong>：实时 UDP 流量和错误。</li><li><strong><code>mpstat -P ALL 1</code></strong>：每个 CPU 的利用率。</li><li><strong><code>top</code> / <code>htop</code></strong>：整体系统资源使用情况。</li><li><strong><code>dmesg</code></strong>：内核日志中与网络相关的错误。</li><li><strong><code>/proc/interrupts</code></strong>：每个 CPU 的中断计数。</li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h2><p>优化网闸连接器性能，特别是在高吞吐量场景下，超越了应用层配置的范畴。通过战略性地调整与 UDP 缓冲、CPU 调度、网卡卸载和中断处理相关的内核参数，管理员可以充分发挥其硬件的潜力，实现跨网闸的可靠、高速数据传输。请务必在受控环境中彻底测试所有更改。</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/ffutop/DataDiodeConnector/edit/master/docs/zh-CN/kernel_tuning.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> 在 GitHub 上编辑此页<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/zh-CN/flow_control" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>上一页</span><span class="title" data-v-1bcd8184>流量控制</span><!--]--></a></div><div class="pager" data-v-1bcd8184><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5>基于 Apache-2.0 许可发布</p><p class="copyright" data-v-5b9946f5>版权所有 © 2020-2025 Ministerie van Defensie & 贡献者</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"en_commercial.md\":\"DwHvMeMF\",\"en_configuration_reference.md\":\"DCgcEUMG\",\"en_deployment_topologies.md\":\"Dn1tRwGi\",\"en_developer_guide.md\":\"CuNhVZD9\",\"en_download.md\":\"IOGx-Xmg\",\"en_flow_control.md\":\"CUjN5fvn\",\"en_index.md\":\"CIBT1yeY\",\"en_kernel_tuning.md\":\"BBGKcKcR\",\"en_operations_guide.md\":\"CkrHA6gr\",\"en_protocol.md\":\"BK_5NiM7\",\"en_roadmap_optimization_2025.md\":\"C9TtFeeN\",\"en_security_model.md\":\"C_M7aJiA\",\"en_software_architecture.md\":\"CLpf2Km5\",\"index.md\":\"CeDYDUec\",\"zh-cn_commercial.md\":\"CPjIKUVv\",\"zh-cn_configuration_reference.md\":\"D2KBZKAD\",\"zh-cn_deployment_topologies.md\":\"NiJmh3GL\",\"zh-cn_developer_guide.md\":\"eiPZkvFT\",\"zh-cn_download.md\":\"BqBfaLyA\",\"zh-cn_flow_control.md\":\"YnEnP7_y\",\"zh-cn_index.md\":\"CDxKxN6A\",\"zh-cn_kernel_tuning.md\":\"CA4NIKu0\",\"zh-cn_operations_guide.md\":\"BG3cRBEa\",\"zh-cn_protocol.md\":\"CU3nUKFb\",\"zh-cn_security_model.md\":\"CPa0fkWF\",\"zh-cn_software_architecture.md\":\"DWVwD773\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Data Diode Connector\",\"description\":\"Secure, high-performance, unidirectional data transfer suite powered by Rust.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ffutop/DataDiodeConnector\"}],\"search\":{\"provider\":\"local\"}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"/en/\",\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/en/\"},{\"text\":\"Guide\",\"link\":\"/en/software_architecture\"},{\"text\":\"Config\",\"link\":\"/en/configuration_reference\"},{\"text\":\"Download\",\"link\":\"/en/download\"},{\"text\":\"Commercial\",\"link\":\"/en/commercial\"}],\"sidebar\":[{\"text\":\"Architecture\",\"collapsed\":false,\"items\":[{\"text\":\"Software Architecture\",\"link\":\"/en/software_architecture\"},{\"text\":\"Deployment Topologies\",\"link\":\"/en/deployment_topologies\"},{\"text\":\"Security Model\",\"link\":\"/en/security_model\"},{\"text\":\"Protocol Specification\",\"link\":\"/en/protocol\"}]},{\"text\":\"Operations & Tuning\",\"collapsed\":false,\"items\":[{\"text\":\"Configuration Reference\",\"link\":\"/en/configuration_reference\"},{\"text\":\"Operations Guide\",\"link\":\"/en/operations_guide\"},{\"text\":\"Flow Control\",\"link\":\"/en/flow_control\"},{\"text\":\"Kernel Tuning\",\"link\":\"/en/kernel_tuning\"}]}],\"footer\":{\"copyright\":\"Copyright © 2025 ffutop\"},\"editLink\":{\"pattern\":\"https://github.com/ffutop/DataDiodeConnector/edit/master/docs/:path\",\"text\":\"Edit this page on GitHub\"}}},\"zh-CN\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"link\":\"/zh-CN/\",\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/zh-CN/\"},{\"text\":\"指南\",\"link\":\"/zh-CN/software_architecture\"},{\"text\":\"配置\",\"link\":\"/zh-CN/configuration_reference\"},{\"text\":\"下载\",\"link\":\"/zh-CN/download\"},{\"text\":\"商业版\",\"link\":\"/zh-CN/commercial\"}],\"sidebar\":[{\"text\":\"架构设计\",\"collapsed\":false,\"items\":[{\"text\":\"软件架构\",\"link\":\"/zh-CN/software_architecture\"},{\"text\":\"部署拓扑与高可用\",\"link\":\"/zh-CN/deployment_topologies\"},{\"text\":\"安全模型\",\"link\":\"/zh-CN/security_model\"},{\"text\":\"协议规范\",\"link\":\"/zh-CN/protocol\"}]},{\"text\":\"运维与调优\",\"collapsed\":false,\"items\":[{\"text\":\"配置参考手册\",\"link\":\"/zh-CN/configuration_reference\"},{\"text\":\"运维指南\",\"link\":\"/zh-CN/operations_guide\"},{\"text\":\"流量控制\",\"link\":\"/zh-CN/flow_control\"},{\"text\":\"内核调优\",\"link\":\"/zh-CN/kernel_tuning\"}]}],\"footer\":{\"message\":\"基于 Apache-2.0 许可发布\",\"copyright\":\"版权所有 © 2020-2025 Ministerie van Defensie & 贡献者\"},\"editLink\":{\"pattern\":\"https://github.com/ffutop/DataDiodeConnector/edit/master/docs/:path\",\"text\":\"在 GitHub 上编辑此页\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"outline\":{\"label\":\"页面导航\"},\"lastUpdated\":{\"text\":\"最后更新于\"},\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"主题\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\"}}},\"scrollOffset\":134,\"cleanUrls\":true,\"additionalConfig\":{}}");</script>
    
  </body>
</html>